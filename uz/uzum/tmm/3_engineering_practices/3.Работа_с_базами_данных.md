# Работа с базами данных

## Ожидание от команды

Команда использует общепринятые подходы к работе с базами данных, выбирает правильные базы для конкретных задач (кау реляционные. так и нереляционные) и умеет
работать с базами в распределённой системе.

## Пример

1. Нет бизнес-логики в базе данных.
2. Реляционные базы используются там, где они нужны.
3. Трафик до редисов.
4. Быстро вымывающийся redis-кэш.
5. Безопасные миграции
6. Не использовать PostgreSQL для кэширования или хранения слишком больших данных.
7. Понимать отличие OLAP от OLTP.

## Зачем эта практика

Хотим, чтобы сервисы использовали правильные подходы к изоляции данных, эффективно утилизировали базы данных и умели корректно в production и reserve

| Уровень 0        | Один инстанс базы данных используется в нескольких сервисах                                                                                                                                                                                                                     |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Как перейти      | - Запланировать задачи на разделение баз данных                                                                                                                                                                                                                                 |
| Уровень 1        | Команда использует только поддерживаемые базы данных. У каждого сервиса своя база данных.                                                                                                                                                                                       |
| Как перейти      | - Провести аудит корректности использования баз данных и запланировать задачи на миграцию в более подходящие базы.<br/>- Запланировать задачи на рефакторинг сервисов, которые используют нестандартные клиенты к базам<br/>- Бизнес логика отсутствует в БД                    |
| Уровень 2 (Base) | Команда выбирает подходящую базу данных для конкретной задачи, использует официально поддерживаемые клиенты, все миграции в репозитории<br/>Команда умеет профилировать медленные запросы и оптимизирует только при проблемах                                                   |
| Как перейти      | - Провести аудит возможности чтения отстающих данных с реплик и запланировать задачи на рефакторинг.<br/>- в DOD задачи учтены возможные риски по миграциям данных, описаны варианты отката<br/>- Команда не допускает даунтайма сервисов при миграциях (отсутствуют инциденты) |
| Уровень 3        | Команда системно проводит аудит БД, превентивно оптимизирует медленные запросы                                                                                                                                                                                                  |
